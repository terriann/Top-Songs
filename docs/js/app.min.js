var Item=Backbone.Model.extend({defaults:{part1:"hello",part2:"world"}});Song=Backbone.Model.extend({defaults:{song_name:null,images:null,link:null,artist_name:null,song_preview:null},initialize:function(a){this.view=new SongView({song_model:this})}});var List=Backbone.Collection.extend({model:Item});Songs=Backbone.Collection.extend({initialize:function(a,b){this.view=b.view,this.bind("add",function(a){this.view.$el.append(a.view.render().el)})}}),AppView=Backbone.View.extend({el:"#song-list",events:{},initialize:function(){this.songs=new Songs(null,{view:this}),this.fetchJson()},fetchJson:function(){var a=this,b="https://itunes.apple.com/us/rss/topsongs/limit=100/explicit=true/json?callback=?";$.getJSON(b,{}).done(function(b){$.each(b.feed.entry,function(b,c){var d={id:c.id.attributes["im:id"],song_name:c["im:name"].label,link:c.link[0].attributes.href,song_preview:c.link[1].attributes.href,artist_name:c["im:artist"].label,images:{small:c["im:image"][0].label,medium:c["im:image"][1].label,large:c["im:image"][2].label}},e=new Song(d);a.songs.add(e)}),$("#song-list").masonry({itemSelector:".card"})})}});var ItemView=Backbone.View.extend({tagName:"li",tplID:"item_tpl",events:{"click span.swap":"swap","click span.delete":"remove"},initialize:function(){_.bindAll(this,"render","unrender","swap","remove"),this.model.bind("change",this.render),this.model.bind("remove",this.unrender)},render:function(){var a=twig({data:$("#"+this.tplID).html()});return $(this.el).html(a.render(this.model.toJSON())),this},unrender:function(){$(this.el).remove()},swap:function(){var a={part1:this.model.get("part2"),part2:this.model.get("part1")};this.model.set(a)},remove:function(){this.model.destroy()}}),ListView=Backbone.View.extend({el:$("body"),tplID:"list_tpl",events:{"click button#add":"addItem"},initialize:function(){_.bindAll(this,"render","addItem","appendItem"),this.collection=new List,this.collection.bind("add",this.appendItem),this.counter=0,this.render()},render:function(){var a=this,b=twig({data:$("#"+this.tplID).html()});$(this.el).append(b.render()),_(this.collection.models).each(function(b){a.appendItem(b)},this)},addItem:function(){this.counter++;var a=new Item;a.set({part2:a.get("part2")+this.counter}),this.collection.add(a)},appendItem:function(a){var b=new ItemView({model:a});$("ul",this.el).append(b.render().el)}});SongView=Backbone.View.extend({tagName:"div",className:"card",events:{hover:"handleHover",mouseover:"handleHover","click .preview":"clickPreview"},initialize:function(a){this.song_model=a.song_model,this.id=a.song_model.get("id"),this.render()},render:function(){var a='<a href="'+this.song_model.get("link")+'"><img src="'+this.song_model.get("images").large+'" class="album" /></a><div class="song">'+this.song_model.get("song_name")+'</div><div class="artist">'+this.song_model.get("artist_name")+'</div><div class="preview"></div>';return this.el.innerHTML=a,this},handleHover:function(a){return console.debug("Hovering! "+a+this),console.debug(a),!1},clickPreview:function(a){alert("play!");var b=new CirclePlayer("#song-"+this.song_model.get("id")+" .preview",{m4a:this.song_model.get("song_preview")},{cssSelectorAncestor:"#cp_container_1"});b.play()}}),function(a){Backbone.sync=function(a,b,c,d){c()};new AppView}(jQuery);
//# sourceMappingURL=app.js.map